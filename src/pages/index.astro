---
import Layout from "../layouts/Layout.astro";
import Hero from "../sections/Hero.astro";
import Noticias from "../components/Noticias.astro";
import Concejales from "../components/Concejales.astro";
import MisionVision from "../components/MisionVision.astro";
import SeparadorWave from "../components/SeparadorWave.astro";
import { fetchGraphQL } from "../lib/wp.ts";
import { InformacionGlobal } from "../lib/queries/global.ts";
import { InformacionConcejales } from "../lib/queries/concejales.ts";

const WP_BASE_URL = import.meta.env.WORDPRESS_API_URL.replace("/graphql", "");

const concejalesData = await fetchGraphQL(InformacionConcejales);

const concejalesList = concejalesData?.concejales?.edges?.map((edge) => {
    const concejalData = edge.node.datosDeConcejales;
    const photoUri = concejalData.fotoDelConcejal?.node?.uri;
    const photoUrl = photoUri ? `${WP_BASE_URL}${photoUri}` : "/concejales/default.jpg";
    return {
        name: concejalData.nombreDeConcejal,
        partido: concejalData.partidoPolitico,
        comunidad: concejalData.comunidad,
        cargo: concejalData.cargo,
        photoUrl: photoUrl,
    };
}) || []; 

const concejalesHome = concejalesList.slice(0, 5);

const data = await fetchGraphQL(InformacionGlobal);
const nodoGlobal = data?.allInformacionGlobal?.edges?.[0]?.node;
const datos = nodoGlobal?.datosGlobales;

const mision = datos?.mision || "";
const vision = datos?.vision || "";

const title = "Inicio";
const description = "Sitio web oficial del Concejo Municipal del Medio Atrato, Chocó. Consulte las iniciativas, normativa, y procesos de participación ciudadana.";
---

<Layout title={title} description={description}>
    <Hero />
    <!-- <SeparadorWave marginY="lg" /> -->
    <Noticias />
    <MisionVision 
        mision={mision}
        vision={vision}
    />
    <Concejales concejalesList={concejalesHome}/>
</Layout>
