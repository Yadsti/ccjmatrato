---
import Layout from "../../layouts/Layout.astro";
import { fetchGraphQL } from "../../lib/wp.ts";
import { InformacionProyectos } from "../../lib/queries/proyectos.ts";

const title = "Proyectos de Acuerdo";
const description = "Consulte el listado y estado de los Proyectos de Acuerdo en trámite del Concejo Municipal del Medio Atrato.";


const proyectosData = await fetchGraphQL(InformacionProyectos);

const proyectosList =
proyectosData?.proyectos?.nodes?.map((node) => {
    const data = node.datosProyectos;
    const documentUrl = data.documentoDeProyecto?.node?.mediaItemUrl || "#";
    const fecha = data.fechaDelProyecto || "";
    const numero = data.numeroDeProyecto || "N/A";
    const titulo = data.tituloDelProyecto || "Proyecto sin título";

    return {
        id: numero,
        title: titulo,
        date: fecha,
        url: documentUrl,
        displayTitle: `Proyecto de Acuerdo No. ${numero}`,
        fullTitle: `${titulo} (${fecha})`,
    };
}) || [];
---

<Layout title={title} description={description}>
    <main class="container mx-auto px-4 py-8 font-sans">
        <h1
        class="text-4xl font-bold text-center text-concejo-verde-principal mb-8"
        >
        Proyectos de Acuerdo en Trámite
        </h1>
        <p class="text-lg text-gray-700 text-center mb-10 max-w-4xl mx-auto">
        Acceda a la información y documentos de los Proyectos de Acuerdo radicados
        ante la corporación.
        </p>

        <div class="mt-8 max-w-5xl mx-auto">
        <h2 class="text-3xl font-bold text-concejo-negro mb-6 border-b pb-2">
            Listado de Proyectos
        </h2>

        {
            proyectosList.length > 0 ? (
            <div class="bg-white rounded-lg shadow-xl divide-y divide-gray-100">
                <ul class="space-y-0">
                {proyectosList.map((proyecto, index) => (
                    <li class="p-4 hover:bg-gray-50 transition-colors duration-200">
                    <a
                        href={proyecto.url}
                        target="_blank"
                        rel="noopener noreferrer"
                        class="flex flex-col sm:flex-row justify-between items-start sm:items-center text-concejo-negro group"
                    >
                        <div class="flex items-start">
                        <i
                            class="fas fa-file-pdf text-concejo-azul-principal text-xl mr-4 mt-1 flex-shrink-0"
                            aria-hidden="true"
                        />
                        <div>
                            <span class="text-sm font-semibold text-concejo-verde-principal">
                            {proyecto.displayTitle}
                            </span>
                            <p class="text-lg font-medium group-hover:underline">
                            {proyecto.title}
                            </p>
                        </div>
                        </div>
                        <div class="text-right mt-2 sm:mt-0 flex-shrink-0">
                        <p class="text-xs text-gray-500">
                            Radicado: {proyecto.date}
                        </p>
                        <span class="text-sm font-semibold text-concejo-azul-principal">
                            Ver Documento →
                        </span>
                        </div>
                    </a>
                    </li>
                ))}
                </ul>
            </div>
            ) : (
            <div class="p-10 text-center text-gray-500 bg-gray-50 rounded-lg shadow-md border border-gray-200">
                <i class="fas fa-box-open text-4xl mb-3" />
                <h3 class="text-xl font-semibold">
                No hay Proyectos de Acuerdo en Trámite.
                </h3>
                <p class="mt-2">
                Actualmente, la corporación no tiene proyectos de acuerdo
                radicados para su consulta pública.
                </p>
            </div>
            )
        }
        </div>
    </main>
</Layout>
