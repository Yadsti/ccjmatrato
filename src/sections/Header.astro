---
import MenuDropdown from '../components/header/MenuDropdown.astro';
import { menuPrincipal } from '../components/header/_HeaderLinks';

export interface Props {
    logoUri: string;
}

const { logoUri } = Astro.props;

let logoPath: string | null = null;
if (logoUri) {
    const WP_BASE_URL = import.meta.env.WORDPRESS_API_URL.replace("/graphql", "");
    logoPath = `${WP_BASE_URL}${logoUri}`;
}

const currentPath = Astro.url.pathname.replace(/\/$/, "");
const isActive = (path: string) => {
    const normalizedPath = path.replace(/\/$/, "");
    if (normalizedPath === "") return currentPath === "";
    return currentPath.startsWith(normalizedPath);
};

const activeClass = "text-concejo-azul-principal border-b-2 border-concejo-azul-principal";
const baseClass = "px-3 py-2 rounded-lg hover:text-concejo-azul-principal transition-colors duration-300";
---

<header
    class="bg-white shadow-lg fixed top-0 left-0 right-0 z-50 border-b border-gray-100 h-16 md:h-20"
>
    <div
        class="max-w-7xl mx-auto h-full flex justify-between items-center px-4 sm:px-6 lg:px-8"
    >
        <a href="/" class="flex items-center gap-2 flex-shrink-0">
            <img
                src={logoPath}
                alt="Logo Concejo Municipal del Medio Atrato"
                class="h-12 md:h-16 w-auto"
            />
        </a>

        <button
            id="menu-toggle"
            class="md:hidden focus:outline-none p-2 rounded-lg hover:bg-gray-100 transition-colors duration-300"
            aria-label="Toggle navigation menu"
        >
            <svg class="w-8 h-8 text-concejo-negro" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path>
            </svg>
        </button>

        <nav
            id="main-nav"
            class="hidden md:flex flex-col md:flex-row space-y-2 md:space-y-0 md:space-x-4 font-medium font-sans absolute md:static top-full left-0 right-0 bg-white shadow-lg md:shadow-none p-4 md:p-0 w-full md:w-auto text-sm lg:text-base"
        >
            {menuPrincipal.map(item => (
                item.subItems ? (
                    <MenuDropdown 
                        item={item} 
                        baseClass={baseClass} 
                        activeClass={activeClass} 
                        isActive={isActive} 
                    />
                ) : (
                    <a 
                        href={item.path} 
                        class:list={[baseClass, isActive(item.path) ? activeClass : ""]}
                    >
                        {item.label}
                    </a>
                )
            ))}
        </nav>
    </div>
</header>

<script>
    const toggleButton = document.getElementById("menu-toggle");
    const navMenu = document.getElementById("main-nav");

    toggleButton.addEventListener("click", () => {
        navMenu.classList.toggle("hidden");
        navMenu.classList.toggle("flex"); 
    });
</script>